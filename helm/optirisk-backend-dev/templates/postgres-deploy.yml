apiVersion: apps/v1
kind: Deployment
metadata:
    name: optirisk-backend-postgres # Unique name for the deployment
    namespace: optirisk
    labels: # Labels to be applied to the Pods in this deployment
        app: optirisk-backend-postgres
spec:
    replicas: 1
    selector:
        matchLabels:
            app: optirisk-backend-postgres
    template:
        metadata:
            labels:
                app: optirisk-backend-postgres
        spec:
            containers:
                - name: postgres
                  image: postgres:17
                  imagePullPolicy: IfNotPresent
                  env:
                      - name: NAME
                        value: {{ .Values.db.name }}
                      - name: USER
                        valueFrom:
                            secretKeyRef:
                                name: {{ .Values.db.secretName }}
                                key: {{ .Values.db.userKey }}        
                      - name: PASSWORD
                        valueFrom:
                            secretKeyRef:
                                name: {{ .Values.db.secretName }}
                                key: {{ .Values.db.passwordKey }}  
                  ports:
                      - containerPort: {{ .Values.db.port }} 
                  volumeMounts:
                      - name: optirisk-backend-pg
                        mountPath: /var/lib/postgresql/data
            volumes:
                - name: optirisk-backend-pg
                  persistentVolumeClaim:
                      claimName: optirisk-backend-pg-pvc
